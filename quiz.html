<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Take the Quiz</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body { background:#111; color:white; font-family:'Orbitron',sans-serif; }

nav .logo { font-weight:700; font-size:1.5rem; padding:10px; }

.quiz-container {
    max-width:700px;
    margin:140px auto;
    text-align:center;
    padding:20px;
}

.start-btn, .answer-btn, .submit-written {
    display:block;
    width:100%;
    padding:18px;
    margin:12px 0;
    font-size:1.2rem;
    border-radius:14px;
    background:rgba(255,255,255,0.15);
    border:1px solid rgba(255,255,255,0.2);
    color:white;
    cursor:pointer;
    transition:0.3s ease;
    backdrop-filter:blur(6px);
}

.start-btn:hover, .answer-btn:hover, .submit-written:hover {
    background:rgba(255,255,255,0.3);
    transform:translateY(-3px);
}

input {
    width:100%;
    padding:14px;
    border-radius:10px;
    border:none;
    margin-top:15px;
    font-size:1.1rem;
}

.slide-out-left { animation: outLeft .45s ease forwards; }
.slide-in-right { animation: inRight .45s ease forwards; }

@keyframes outLeft {
    from { opacity:1; transform:translateX(0); }
    to { opacity:0; transform:translateX(-80px); }
}

@keyframes inRight {
    from { opacity:0; transform:translateX(80px); }
    to { opacity:1; transform:translateX(0); }
}

@keyframes growShrink {
  0%,100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-10px) scale(1.3); }
}
</style>
</head>

<body>

<nav>
  <div class="logo">Camp Citizen</div>
</nav>

<div class="quiz-container">

<!-- EMAIL SCREEN -->
<div id="email-screen">
  <h1>Enter Your Email</h1>
  <input type="email" id="userEmail" placeholder="you@example.com">
  <button class="start-btn" onclick="saveEmail()">Continue</button>
</div>

<!-- START SCREEN -->
<div id="start-screen" style="display:none;">
  <h1 id="animatedTitle">Take the Quiz?</h1>
  <button class="start-btn" onclick="showNotice()">START</button>
</div>

<!-- NOTICE SCREEN -->
<div id="notice-screen" style="display:none;">
  <h1>Before You Start</h1>
  <p style="margin:20px 0;">
    This quiz has no right or wrong answers.<br>
    Please answer honestly and try your best.
  </p>
  <button class="start-btn" onclick="confirmStart()">OK</button>
</div>

<!-- QUESTION SCREEN -->
<div id="question-screen" style="display:none;">
  <h1 id="question-text"></h1>
  <div id="answers"></div>
</div>

<!-- END SCREEN -->
<div id="end-screen" style="display:none;">
  <h1>Quiz Complete!</h1>
  <p>Your response has been sent for review.</p>
</div>

</div>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD4bDMS9X_HqSDa-2qVTZKNNsXVVA1A1A4",
  authDomain: "gggg-2095f.firebaseapp.com",
  projectId: "gggg-2095f",
  storageBucket: "gggg-2095f.firebasestorage.app",
  messagingSenderId: "1047765928516",
  appId: "1:1047765928516:web:6fe090e104b7bf735a8a11"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* AUTH GUARD */
onAuthStateChanged(auth, user => {
  if (!user) window.location.href = "login.html";
});

/* ================= QUIZ ================= */
const questions = [
  { text:"When did you join Star Citizen?", type:"multiple", answers:["Before this group","Before 2020","Past 2 years","When it began"] },
  { text:"How much do you know?", type:"multiple", answers:["Just enough","Little","A lot","Nothing"] },
  { text:"Why do you want to join?", type:"written" },
  { text:"What can you bring?", type:"written" }
];

let currentQuestion = 0;
let responses = [];

window.saveEmail = () => {
  const email = userEmail.value.trim();
  if (!email.includes("@")) return alert("Enter a valid email");
  localStorage.setItem("quizEmail", email);
  email-screen.style.display = "none";
  start-screen.style.display = "block";
};

window.showNotice = () => {
  start-screen.style.display = "none";
  notice-screen.style.display = "block";
};

window.confirmStart = () => {
  notice-screen.style.display = "none";
  startQuiz();
};

function startQuiz() {
  question-screen.style.display = "block";
  loadQuestion(true);
}

function loadQuestion(first=false) {
  const q = questions[currentQuestion];
  question-text.textContent = q.text;
  answers.innerHTML = "";

  if (q.type === "multiple") {
    q.answers.forEach(a => {
      const b = document.createElement("button");
      b.className = "answer-btn";
      b.textContent = a;
      b.onclick = () => submitAnswer(a);
      answers.appendChild(b);
    });
  } else {
    const input = document.createElement("input");
    input.placeholder = "Type your answer...";
    const btn = document.createElement("button");
    btn.className = "submit-written";
    btn.textContent = "Submit";
    btn.onclick = () => input.value && submitAnswer(input.value);
    answers.append(input, btn);
  }
}

async function submitAnswer(ans) {
  responses.push({ question: questions[currentQuestion].text, answer: ans });
  currentQuestion++;
  currentQuestion >= questions.length ? finishQuiz() : loadQuestion();
}

async function finishQuiz() {
  await addDoc(collection(db,"quizSubmissions"),{
    email: localStorage.getItem("quizEmail"),
    responses,
    approved:false,
    submittedAt:serverTimestamp()
  });
  question-screen.style.display = "none";
  end-screen.style.display = "block";
}

/* TITLE ANIMATION */
const title = document.getElementById("animatedTitle");
const text = title.textContent;
title.textContent = "";
[...text].forEach((c,i)=>{
  const s=document.createElement("span");
  s.textContent=c;
  s.style.display="inline-block";
  s.style.animation=`growShrink 1s ease-in-out infinite`;
  s.style.animationDelay=`${i*0.1}s`;
  title.appendChild(s);
});
</script>

</body>
</html>
