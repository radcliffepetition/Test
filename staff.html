<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Staff Review</title>
<style>
body { background: #111; color: white; font-family: 'Orbitron', sans-serif; text-align: center; padding: 40px; }
h1 { font-weight: 700; margin-bottom: 30px; }
button { padding: 12px 20px; margin: 8px; font-size: 1rem; cursor: pointer; border-radius: 8px; border: none; transition: 0.3s; }
button:hover { transform: translateY(-2px); }
.approve { background: #00ff88; color: black; font-weight: 600; }
.deny { background: #ff5555; color: black; font-weight: 600; }
.submission-block { background: #222; padding: 20px; margin: 15px auto; max-width: 700px; border-radius: 12px; text-align: left; box-shadow: 0 0 15px #00f; transition: 0.3s; }
.submission-block h3 { margin: 0 0 10px 0; }
.submission-block p { margin: 5px 0; }
</style>
</head>
<body>



<h1>Quiz Submissions</h1>
<div id="submissionsContainer">Loading submissions...</div>

<script type="module">
// ================= FIREBASE IMPORTS =================
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, where, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ================= FIREBASE CONFIG =================
const firebaseConfig = {
  apiKey: "AIzaSyD4bDMS9X_HqSDa-2qVTZKNNsXVVA1A1A4",
  authDomain: "gggg-2095f.firebaseapp.com",
  projectId: "gggg-2095f",
  storageBucket: "gggg-2095f.firebasestorage.app",
  messagingSenderId: "1047765928516",
  appId: "1:1047765928516:web:6fe090e104b7bf735a8a11",
  measurementId: "G-HYZ2GQZ0GW"
};

// ================= FIREBASE INIT =================
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================= LOAD PENDING SUBMISSIONS =================
const submissionsContainer = document.getElementById("submissionsContainer");

async function loadSubmissions() {
    submissionsContainer.innerHTML = "Loading submissions...";

    try {
        // üîπ Only fetch submissions where approved == false (pending)
        const q = query(collection(db, "quizSubmissions"), where("approved", "==", false));
        const querySnapshot = await getDocs(q);

        submissionsContainer.innerHTML = "";

        if (querySnapshot.empty) {
            submissionsContainer.innerHTML = "<p>No submissions yet.</p>";
            return;
        }

        querySnapshot.forEach((docSnap) => {
            const data = docSnap.data();
            const block = document.createElement("div");
            block.className = "submission-block";

            block.innerHTML = `<h3>Submission ID: ${docSnap.id}</h3>`;

            data.responses.forEach((resp, idx) => {
                block.innerHTML += `<p><strong>Q${idx+1}: ${resp.question}</strong><br>Answer: ${resp.answer}</p>`;
            });

            const approveBtn = document.createElement("button");
            approveBtn.textContent = "Approve";
            approveBtn.className = "approve";
            approveBtn.onclick = async () => {
                await updateDoc(doc(db, "quizSubmissions", docSnap.id), { approved: true });
                block.style.backgroundColor = "#004400";
                block.innerHTML += "<p>‚úÖ Approved</p>";
                block.querySelectorAll("button").forEach(btn => btn.disabled = true);
            };
            block.appendChild(approveBtn);

            const denyBtn = document.createElement("button");
            denyBtn.textContent = "Deny";
            denyBtn.className = "deny";
            denyBtn.onclick = async () => {
                await updateDoc(doc(db, "quizSubmissions", docSnap.id), { approved: false });
                block.style.backgroundColor = "#440000";
                block.innerHTML += "<p>‚ùå Denied</p>";
                block.querySelectorAll("button").forEach(btn => btn.disabled = true);
            };
            block.appendChild(denyBtn);

            submissionsContainer.appendChild(block);
        });

    } catch (err) {
        submissionsContainer.innerHTML = `<p>Error loading submissions: ${err.message}</p>`;
        console.error(err);
    }
}

// Load submissions when page opens
loadSubmissions();

</script>
</body>
</html>
